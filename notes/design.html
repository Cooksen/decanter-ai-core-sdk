

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Design Notes &#8212; decanter-ai-core-sdk 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="Developer Interface" href="../api.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../api.html" title="Developer Interface"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">decanter-ai-core-sdk 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Design Notes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="design-notes">
<span id="design"></span><h1>Design Notes<a class="headerlink" href="#design-notes" title="Permalink to this headline">¶</a></h1>
<p>If you are curious why Decanter AI Core SDK does certain things the way it does and not differently, this section is for you.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decanter-ai">
<h3>Decanter AI<a class="headerlink" href="#decanter-ai" title="Permalink to this headline">¶</a></h3>
<p>Decanter AI is an AutoML tool, which is able to do feature engineering, auto model training and prediction.</p>
</div>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>There are 4 actions that are provided by Decanter AI.</p>
<ol class="arabic simple">
<li><p>Upload Data: User has to upload the data to Decanter AI that is used for training or predicting.</p></li>
<li><p>Setup Data: Change data column type</p></li>
<li><p>Train Data: Training models, based on the data upload previously.</p></li>
<li><p>Predict Data: Predicting the data with the model which is trained previously.</p></li>
</ol>
</div>
</div>
<div class="section" id="design-decisions">
<h2>Design Decisions<a class="headerlink" href="#design-decisions" title="Permalink to this headline">¶</a></h2>
<p>When a developer is using Decanter’s API, such as using upload api to upload a csv file.
He needs to start the upload by sending the upload request and monitor the status by continuously sending requests and receiving responses from getting task api. It’s not that convenient and it’ll block other processes while waiting for the task to be done, causing the decanter server to waste its resources, since it can process up to four tasks at a time.</p>
<p>In order to let the user handle tasks more efficiently and intuitively, there are three main goals:</p>
<ol class="arabic simple">
<li><p>The user needs not be aware of the existence of API.</p></li>
<li><p>The user needs not be aware of the task lifecycle.</p></li>
<li><p>Non-blocking when running tasks that don’t have a dependency relationship.
(ex. Tasks of uploading train and test data don’t depend on each other,
making them run concurrently and asynchronously saves more time.)</p></li>
</ol>
</div>
<div class="section" id="design-overview">
<h2>Design Overview<a class="headerlink" href="#design-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="context-module">
<h3>Context Module<a class="headerlink" href="#context-module" title="Permalink to this headline">¶</a></h3>
<p><cite>Context</cite> module manages the global eventloop.</p>
</div>
<div class="section" id="client-module">
<h3>Client Module<a class="headerlink" href="#client-module" title="Permalink to this headline">¶</a></h3>
<p><cite>Client</cite> module provides main function SDK users, including 4 actions. The user creates the actions with specified parameters, therefore, it will put the task into eventloop list which is managed by <cite>Context</cite>.</p>
</div>
<div class="section" id="coreapi-module">
<h3>CoreAPI Module<a class="headerlink" href="#coreapi-module" title="Permalink to this headline">¶</a></h3>
<p><cite>CoreAPI</cite> module is a client of Decanter AI Server. Its responsibility is to communicate with Decanter AI server.</p>
</div>
<div class="section" id="job-and-task-module">
<h3>Job and Task Module<a class="headerlink" href="#job-and-task-module" title="Permalink to this headline">¶</a></h3>
<p>We mainly have four actions to do during training models:</p>
<ul class="simple">
<li><p>Upload(<cite>Task</cite>) ⇒ DataUpload(<cite>Job</cite>)</p></li>
<li><p>Setup ⇒ DataUpload</p></li>
<li><p>Train ⇒ Experiment</p></li>
<li><p>Predict ⇒Predict Result</p></li>
</ul>
<p>We structure the result we want to get as a <cite>Job</cite> which will store the
properties we wish to get easily. Ｗe let every corresponding action be
a <cite>Task</cite> which will be executed by a <cite>Job</cite> in order to get the result from it.</p>
<p>The relationship between <a class="reference internal" href="../api.html#decanter.core.jobs.job.Job" title="decanter.core.jobs.job.Job"><code class="xref py py-class docutils literal notranslate"><span class="pre">Job</span></code></a>
and <a class="reference internal" href="../api.html#decanter.core.jobs.task.Task" title="decanter.core.jobs.task.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code></a></p>
<ol class="arabic simple">
<li><p>Each <cite>Job</cite> has a <cite>Task</cite> and the <cite>Job</cite>’s mission is to execute
the <cite>Task</cite> and wait for it until it’s done.</p></li>
<li><p><cite>Job</cite>’s properties (or attributes) is the result of the <cite>Task</cite>.</p></li>
<li><p>When every <cite>Job</cite> starts to execute and gets the result from <cite>Task</cite>,
it needs to wait for all the <cite>Job</cite> in its jobs list to be done.</p></li>
</ol>
<p>Ex. <cite>PredictResult &lt;Job&gt;</cite> must wait for <cite>Experiment &lt;Job&gt;</cite>
and <cite>DataUpload &lt;Job&gt;</cite> to be done.</p>
</div>
</div>
</div>
<div class="section" id="how-to-do-it-asynchronously">
<h1>How to do it asynchronously?<a class="headerlink" href="#how-to-do-it-asynchronously" title="Permalink to this headline">¶</a></h1>
<p>Why do we need asynchronous functionality? Since the decanter server can actually handle
upto 4 tasks running at once, if we do the job synchronously, we could
only do one task at a  time which is time-wasting.</p>
<p>We address this by using the <span class="xref std std-doc">library/asyncio-taskv</span> in the Python asyncio library
We use <code class="docutils literal notranslate"><span class="pre">await</span></code> to handle the blocking problems. According to
<a class="reference external" href="https://www.aeracode.org/2018/02/19/python-async-simplified/">this passage</a>.</p>
<p>“When you call <code class="docutils literal notranslate"><span class="pre">await</span></code>, the function you’re in gets suspended while whatever
you asked to wait on happens, and then when it’s finished, the event loop will
wake the function up again and resume it from the await call, passing any
result out.”</p>
<p>Therefore, coroutines that involve time-consuming calls such as calling APIs
or waiting for pre-requests <cite>Job</cite> to be done will be blocked and idle, and this
is the condition we can call <code class="docutils literal notranslate"><span class="pre">await</span></code>. It’ll block the currently running
coroutines and put them onto the event loop’s list of paused coroutines so something
else can be run.</p>
<p>In <cite>Job</cite> there are two blocking conditions:</p>
<ol class="arabic simple">
<li><p>Waiting for undone pre-requests jobs: Call <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">asyncio.sleep()</span></code> to
suspend the current running coroutine and resume after a few seconds. Means
that <code class="docutils literal notranslate"><span class="pre">Job.wait()</span></code> check the jobs status every five seconds.</p></li>
<li><p>Calling API: When calling <code class="docutils literal notranslate"><span class="pre">self.update()</span></code> the <cite>Task</cite> will fetch the
result from Decanter AI server, we use <code class="docutils literal notranslate"><span class="pre">await</span></code> to wait for the result,
so it can run other coroutines while waiting for the response.</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">Job.wait</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pesudo code of the coroutine Job.wait()</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># check if all the jobs in list is done</span>
    <span class="c1"># if haven&#39;t call sleep to let other coroutine can be execute</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="nb">all</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="ow">is</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># if there&#39;s jobs failed the coroutine fails to and no need to execute</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="ow">is</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># start to execute task</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># keep update task result and Job properties by calling self.update</span>
    <span class="c1"># finshed when task is done</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">not_done</span><span class="p">():</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># update the status of the Job</span>
    <span class="c1"># other jobs that waits for this can know that it&#39;s done</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="structure-flow-overview">
<h1>Structure Flow Overview<a class="headerlink" href="#structure-flow-overview" title="Permalink to this headline">¶</a></h1>
<p>When we create the client of CoreClient() <code class="docutils literal notranslate"><span class="pre">client</span> <span class="pre">=</span> <span class="pre">CoreClient()</span></code> we simply
create a <cite>Job</cite>. And its coroutines <code class="docutils literal notranslate"><span class="pre">Job.wait()</span></code> will be scheduled to
execute in the event loop.</p>
<div class="figure align-default">
<img alt="../_images/flow_1.png" src="../_images/flow_1.png" />
</div>
<p>Notice that the event loop won’t start to run until we call
<code class="docutils literal notranslate"><span class="pre">context.run()</span></code> and each <cite>Job</cite> has its own <cite>Task</cite> waiting to be finished.</p>
<div class="figure align-default">
<img alt="../_images/flow_2.png" src="../_images/flow_2.png" />
</div>
<p>But each <cite>Job</cite>’s task has different timing to start, as shown by the picture below.
Ex. exp needs to wait for train data to finish, and pred_res needs to
wait for test data and exp.</p>
<div class="figure align-default">
<img alt="../_images/flow_3.png" src="../_images/flow_3.png" />
</div>
<p>When a <cite>Job</cite> is finished, it will set its <code class="docutils literal notranslate"><span class="pre">is_done</span></code> tag to true, and
leave the event loop.</p>
<div class="figure align-default">
<img alt="../_images/flow_4.png" src="../_images/flow_4.png" />
</div>
<p>Since the <cite>Job</cite> that waits for other <cite>Job</cite> s  will keep monitoring its <code class="docutils literal notranslate"><span class="pre">is_done</span></code> tag,
when it finds all of the <cite>Job</cite> s its waiting are done, it will start to run
its own <cite>Task</cite>.</p>
<div class="figure align-default">
<img alt="../_images/flow_5.png" src="../_images/flow_5.png" />
</div>
<div class="figure align-default">
<img alt="../_images/flow_6.png" src="../_images/flow_6.png" />
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Design Notes</a><ul>
<li><a class="reference internal" href="#background">Background</a><ul>
<li><a class="reference internal" href="#decanter-ai">Decanter AI</a></li>
<li><a class="reference internal" href="#actions">Actions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#design-decisions">Design Decisions</a></li>
<li><a class="reference internal" href="#design-overview">Design Overview</a><ul>
<li><a class="reference internal" href="#context-module">Context Module</a></li>
<li><a class="reference internal" href="#client-module">Client Module</a></li>
<li><a class="reference internal" href="#coreapi-module">CoreAPI Module</a></li>
<li><a class="reference internal" href="#job-and-task-module">Job and Task Module</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-do-it-asynchronously">How to do it asynchronously?</a></li>
<li><a class="reference internal" href="#structure-flow-overview">Structure Flow Overview</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../api.html"
                        title="previous chapter">Developer Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="changelog.html"
                        title="next chapter">Changelog</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changelog.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="../api.html" title="Developer Interface"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">decanter-ai-core-sdk 1.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Design Notes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, MoBagel.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>